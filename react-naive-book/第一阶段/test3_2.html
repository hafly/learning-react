<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="renderer" content="webkit">
    <title>å‰ç«¯ç»„ä»¶åŒ–ï¼ˆäºŒï¼‰ï¼šä¼˜åŒ– DOM æ“ä½œ</title>
</head>
<body>
<!--çŠ¶æ€æ”¹å˜ -> æ„å»ºæ–°çš„ DOM å…ƒç´ æ›´æ–°é¡µé¢-->
<!--è¿™é‡Œè¦æå‡ºçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå°±é‡æ–°è°ƒç”¨ render æ–¹æ³•ï¼Œæ„å»ºä¸€ä¸ªæ–°çš„ DOM å…ƒç´ ã€‚-->
<div class='wrapper'></div>
<script>
    const createDOMFromString = (domString) => {
        const div = document.createElement('div')
        div.innerHTML = domString
        return div
    }

    class LikeButton {
        constructor () {
            this.state = { isLiked: false }
        }

        /*å¦‚æœæˆ‘è¦é‡æ–°å¦å¤–åšä¸€ä¸ªæ–°ç»„ä»¶ï¼Œè­¬å¦‚è¯´è¯„è®ºç»„ä»¶ï¼Œé‚£ä¹ˆé‡Œé¢çš„è¿™äº› setState æ–¹æ³•è¦é‡æ–°å†™ä¸€éï¼Œå…¶å®è¿™äº›ä¸œè¥¿éƒ½å¯ä»¥æŠ½å‡ºæ¥ï¼Œå˜æˆä¸€ä¸ªé€šç”¨çš„æ¨¡å¼ã€‚*/
        // åªè¦è°ƒç”¨ setStateï¼Œç»„ä»¶å°±ä¼šé‡æ–°æ¸²æŸ“ã€‚é¡ºåˆ©åœ°æ¶ˆé™¤äº†æ‰‹åŠ¨çš„ DOM æ“ä½œã€‚
        setState (state) {
            const oldEl = this.el; // æ—§çš„å…ƒç´ ï¼ˆéœ€è¦åˆ é™¤ï¼‰
            this.state = state
            this.el = this.render()

            if (this.onStateChange) this.onStateChange(oldEl, this.el)
        }

        changeLikeText () {
            this.setState({
                isLiked: !this.state.isLiked
            })
        }

        render () {
            this.el = createDOMFromString(`
        <button class='like-btn'>
          <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}</span>
          <span>ğŸ‘</span>
        </button>
      `)
            this.el.addEventListener('click', this.changeLikeText.bind(this), false)
            return this.el
        }
    }

    const wrapper = document.querySelector('.wrapper')

    const likeButton = new LikeButton()
    wrapper.appendChild(likeButton.render())

    // setState éƒ½ä¼šè°ƒç”¨ onStateChange æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯å®ä¾‹åŒ–ä»¥åæ—¶å€™è¢«è®¾ç½®çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥è‡ªå®šä¹‰ onStateChange çš„è¡Œä¸º
    likeButton.onStateChange = (oldEl, newEl) => {
        wrapper.insertBefore(newEl, oldEl) // æ’å…¥æ–°çš„å…ƒç´ 
        wrapper.removeChild(oldEl) // åˆ é™¤æ—§çš„å…ƒç´ 
    }
</script>
<!--è¿™é‡Œå·²ç»åšåˆ°äº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–äº†ï¼šç°åœ¨ä¸éœ€è¦å†æ‰‹åŠ¨æ›´æ–°é¡µé¢äº†ã€‚-->
<!--éä¸€èˆ¬çš„æš´åŠ›ï¼Œå› ä¸ºæ¯æ¬¡ setState éƒ½é‡æ–°æ„é€ ã€æ–°å¢ã€åˆ é™¤ DOM å…ƒç´ ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨è¿›è¡Œå¤§é‡çš„é‡æ’ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚
ä¸è¿‡æ²¡æœ‰å…³ç³»ï¼Œè¿™ç§æš´åŠ›è¡Œä¸ºå¯ä»¥è¢«ä¸€ç§å« Virtual-DOM çš„ç­–ç•¥è§„é¿æ‰ï¼Œä½†è¿™ä¸æ˜¯æœ¬æ–‡æ‰€è®¨è®ºçš„èŒƒå›´ã€‚-->
</body>
</html>